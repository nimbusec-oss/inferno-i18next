{"version":3,"file":"bundle.min.js","sources":["../src/Provider.js","../src/translate.js","../src/T.js"],"sourcesContent":["import { Component } from 'inferno';\nimport { throwError } from 'inferno-shared';\n\nexport default class Provider extends Component {\n\n  /**\n   * Create a new i18next provider instance.\n   *\n   * @param {object} props\n   * @param {object} context\n   * @throws {object} Error\n   * @returns {void}\n   */\n  constructor(props, context) {\n    super(props, context);\n    if (!props.i18next) {\n      throwError('an instance of i18next is required');\n    }\n  }\n\n  /**\n   * Return the context for child components.\n   *\n   * @returns {object}\n   */\n  getChildContext() {\n    return {i18next: this.props.i18next};\n  }\n\n  /**\n   * Handle the new props before it gets accepted.\n   *\n   * @param {object} nextProps\n   * @throws {object} Error\n   * @returns {void}\n   */\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.i18next !== this.props.i18next) {\n      throwError('changing of i18next instance is not supported');\n    }\n  }\n\n  /**\n   * Render the component.\n   *\n   * @returns {object}\n   */\n  render() {\n    return this.props.children;\n  }\n\n}\n","import { Component } from 'inferno';\nimport { createElement } from 'inferno-create-element';\nimport { isArray, isString, throwError } from 'inferno-shared';\n\n/**\n * Make the target component translatable.\n *\n * @param {object} TargetComponent\n * @param {string|array} ns\n * @returns {object}\n */\nfunction translate(TargetComponent, ns) {\n  class Translate extends Component {\n    /**\n     * Create a new translate HOC instance.\n     *\n     * @param {object} props\n     * @param {object} context\n     * @throws {object} Error\n     * @returns {void}\n     */\n    constructor(props, context) {\n      super(props, context);\n      if (!context.i18next) {\n        throwError('an instance of i18next must be provided');\n      }\n      this.i18next = context.i18next;\n      this.ns = ns || this.i18next.options.defaultNS;\n    }\n\n    /**\n     * Return the context for child components.\n     *\n     * @returns {object}\n     */\n    getChildContext() {\n      return {\n        t: this.t,\n        i18next: this.i18next,\n      };\n    }\n\n    /**\n     * Handle the component before it gets mounted to the DOM.\n     *\n     * @returns {void}\n     */\n    componentWillMount() {\n      this.t = this.i18next.getFixedT(null, this.ns);\n    }\n\n    /**\n     * Render the component.\n     *\n     * @returns {object}\n     */\n    render() {\n      return createElement(TargetComponent, {\n        ...this.props,\n        t: this.t,\n        i18next: this.i18next,\n      });\n    }\n\n  }\n\n  Translate.displayName = 'Translate' + getDisplayName(TargetComponent);\n  return Translate;\n}\n\n//  ____ ______________.___.____    .___________________.___.\n// |    |   \\__    ___/|   |    |   |   \\__    ___/\\__  |   |\n// |    |   / |    |   |   |    |   |   | |    |    /   |   |\n// |    |  /  |    |   |   |    |___|   | |    |    \\____   |\n// |______/   |____|   |___|_______ \\___| |____|    / ______|\n//                                 \\/               \\/\n\nfunction getDisplayName(component) {\n  return component.displayName || component.name || 'Component';\n}\n\n//  __      ____________    _____ _________________________________________\n// /  \\    /  \\______   \\  /  _  \\\\______   \\______   \\_   _____/\\______   \\\n// \\   \\/\\/   /|       _/ /  /_\\  \\|     ___/|     ___/|    __)_  |       _/\n//  \\        / |    |   \\/    |    \\    |    |    |    |        \\ |    |   \\\n//   \\__/\\  /  |____|_  /\\____|__  /____|    |____|   /_______  / |____|_  /\n//        \\/          \\/         \\/                           \\/         \\/\n\nexport default function wrap(arg) {\n  if (isString(arg) || isArray(arg)) {\n    return component => translate(component, arg);\n  }\n  return translate(arg);\n}\n","import { Component } from 'inferno';\nimport { cloneVNode } from 'inferno-clone-vnode';\nimport { createElement } from 'inferno-create-element';\nimport { VNodeFlags } from 'inferno-vnode-flags';\nimport HTML from 'html-parse-stringify2';\n\nfunction hasChildren(node) {\n\treturn node && (node.children || (node.props && node.props.children));\n}\n\nfunction getChildren(node) {\n\treturn node && (node.children ? node.children : node.props && node.props.children);\n}\n\nfunction renderNodes(children, targetString, i18n, interpolation) {\n\tif (targetString === '') return [];\n\n\t// parse ast from string with additional wrapper tag\n\t// -> avoids issues in parser removing prepending text nodes\n\tconst ast = HTML.parse(`<0>${targetString}</0>`);\n\n\tfunction mapAST(reactNodes, astNodes) {\n\t\treactNodes = reactNodes ? (Array.isArray(reactNodes) ? reactNodes : [reactNodes]) : [];\n\t\tastNodes = astNodes ? (Array.isArray(astNodes) ? astNodes : [astNodes]) : [];\n\n\t\tconst ne = astNodes.reduce((mem, node, i) => {\n\t\t\tif (node.type === 'tag') {\n\t\t\t\tconst child = reactNodes[parseInt(node.name, 10)] || reactNodes[0];\n\t\t\t\tconst isElement = isValidElement(child);\n\n\t\t\t\tif (hasChildren(child)) {\n\t\t\t\t\tconst inner = mapAST(getChildren(child), node.children);\n\t\t\t\t\tmem.push(cloneVNode(child, { ...child.props, key: i }, inner))\n\t\t\t\t} else {\n\t\t\t\t\tmem.push(child);\n\t\t\t\t}\n\t\t\t} else if (node.type === 'text') {\n\t\t\t\tconst interpolated = i18n.services.interpolator.interpolate(node.content, interpolation, i18n.language);\n\t\t\t\tmem.push(interpolated);\n\t\t\t}\n\t\t\treturn mem;\n\t\t}, []);\n\t\treturn ne\n\t}\n\n\t// call mapAST with having react nodes nested into additional node like\n\t// we did for the string ast from translation\n\t// return the children of that extra node to get expected result\n\tconst result = mapAST([{ dummy: true, children, flags: VNodeFlags.HtmlElement, type: 'div' }], ast);\n\treturn getChildren(result[0]);\n}\n\nfunction isValidElement(elem) {\n\t// is valid inferno vnode https://infernojs.org/docs/api/inferno\n\treturn (elem.flags & (VNodeFlags.Component | VNodeFlags.Element)) > 0;\n}\n\n\nexport default class T extends Component {\n\trender() {\n\t\tconst contextAndProps = { i18next: this.context.i18next, t: this.context.i18next.getFixedT(), ...this.props };\n\t\tconst { children, count, parent, i18nKey, i18next, t: tFromContextAndProps, ...additionalProps } = contextAndProps;\n\t\tconst t = tFromContextAndProps || i18next.t.bind(i18next);\n\n\t\tconst useAsParent = parent !== undefined ? parent : 'div';\n\n\t\tconst translation = i18nKey ? t(i18nKey, { interpolation: { prefix: '#$?', suffix: '?$#' }, count }) : '';\n\n\t\treturn createElement(\n\t\t\tuseAsParent,\n\t\t\tadditionalProps,\n\t\t\trenderNodes(children, translation, i18next, contextAndProps.interpolation)\n\t\t);\n\t}\n}\n"],"names":["Provider","props","context","_this","_classCallCheck","this","i18next","throwError","value","nextProps","children","Component","translate","TargetComponent","ns","component","Translate","_Component","_inherits","_super","_createSuper","options","defaultNS","_createClass","key","t","getFixedT","createElement","_objectSpread","displayName","name","getChildren","node","renderNodes","targetString","i18n","interpolation","ast","HTML","parse","concat","result","mapAST","reactNodes","astNodes","Array","isArray","reduce","mem","i","type","child","parseInt","flags","VNodeFlags","Element","hasChildren","inner","push","cloneVNode","interpolated","services","interpolator","interpolate","content","language","dummy","HtmlElement","T","contextAndProps","count","parent","i18nKey","tFromContextAndProps","additionalProps","_excluded","bind","useAsParent","undefined","translation","prefix","suffix","arg","isString"],"mappings":"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"}